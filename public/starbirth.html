<!DOCTYPE html>
<html>
<head>
    <title>Starbirth Viewer</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        html, body, #map { height: 100%; width: 100%; margin: 0; background: #000; }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. Initialize the map
    var map = L.map('map', {
        crs: L.CRS.Simple,
        minZoom: 0
    });

    // 2. Set a default view to ensure the map always loads something
    map.setView([0, 0], 1);

    // 3. Define the path to your tiles folder
    var tileUrl = '../assets/starbirth_tiles/{z}/{x}/{y}.png';

    const CustomLayer = L.TileLayer.extend({
        getTileUrl: function(coords) {
            // Invert the Y coordinate
            var invertedY = Math.pow(2, coords.z) - 1 - coords.y;
            return L.Util.template(this._url, L.extend({
                s: this._getSubdomain(coords),
                x: coords.x,
                y: invertedY,
                z: coords.z,
                invY: invertedY // Provide invY for template use
            }, this.options));
        }
    });
    // 4. Create the tile layer
    var layer = new CustomLayer(tileUrl, {
        attribution: 'Data Credit: NASA/ESA , Made by: cosmic canvas',
        maxZoom: 9, // Adjust if your max zoom is different
        // adjust gaps in tiles
        noGap: true,
        tms: true,
        noWrap: true
    }).addTo(map);

    // 5. Wait for the TILE LAYER to load, then fit the bounds.
    //    This is more reliable than waiting for the map.
    layer.on('load', function() {
        map.fitBounds(layer.getBounds());
    });
</script>
</body>
</html>